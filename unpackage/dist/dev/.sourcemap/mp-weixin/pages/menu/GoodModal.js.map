{"version":3,"file":"goodModal.js","sources":["pages/menu/goodModal.vue","../../Program Files/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RjovY29kZS9CdXJnZXJPcmRlci9wYWdlcy9tZW51L2dvb2RNb2RhbC52dWU"],"sourcesContent":["<template>\r\n\t<uni-popup ref=\"popupRef\" type=\"bottom\" @change=\"modalChange\">\r\n\t\t<view class=\"container\" >\r\n\t\t\t<view class=\"iconfont icon-close close p-1 radius-circle\"></view>\r\n\t\t\t<!-- <scroll-view class=\"flex column good items-center\">\r\n\t\t\t\t<view class=\"good-img p-2\">\r\n\t\t\t\t\t<image :src=\"props.good?.image\" mode=\"aspectFit\" style=\"width: 100%\"></image>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"good-main flex justify-between items-center\">\r\n\t\t\t\t\t<text class=\"good-label  fs-md\">{{props.good?.label}}</text>\r\n\t\t\t\t\t<text class=\"good-sell fs-sm\">月售{{props.good?.sell}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"add flex column\">\r\n\t\t\t\t\t<text class=\"add-title fs-sm\">来点小料</text>\r\n\t\t\t\t\t<view v-for=\"(ingredient,key) in ingredientList\" :key=\"key\"\r\n\t\t\t\t\t\tclass=\"add-item flex justify-between items-center\">\r\n\t\t\t\t\t\t<text class=\"add-item-label\">{{ingredient.label}}</text>\r\n\t\t\t\t\t\t<text class=\"add-item-price\">￥{{ingredient.price}}</text>\r\n\t\t\t\t\t\t<AddSubtractButton @reduce=\"(total)=>updateAddMap(ingredient,total)\"\r\n\t\t\t\t\t\t\t@add=\"(total)=>updateAddMap(ingredient,total)\"></AddSubtractButton>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view> -->\r\n\t\t\t<!-- <view class=\"flex justify-between bottom-add p-1\" v-show=\"addListTitleShow\">\r\n\t\t\t\t<text class=\"fs-sm\">已选：{{addListTitle}}</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"bottom flex justify-between column m-2\">\r\n\r\n\t\t\t\t<view class=\"flex justify-between bottom-total\">\r\n\t\t\t\t\t<text class=\"bottom-total-title fs-md\">￥<text\r\n\t\t\t\t\t\t\tclass=\"bottom-total-price fs-xl\">{{totalPrice}}</text>/个</text>\r\n\t\t\t\t\t<AddSubtractButton @reduce=\"updateGoodTotal\" @add=\"updateGoodTotal\" :init=\"1\" :minNumber=\"1\">\r\n\t\t\t\t\t</AddSubtractButton>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"flex justify-between \">\r\n\t\t\t\t\t<SButton @tap=\"buyNow\" class=\"bottom-btn\">立即购买</SButton>\r\n\t\t\t\t\t<SButton @tap=\"addCart\" class=\"bottom-btn\" primary>加入购物车</SButton>\r\n\t\t\t\t</view>\r\n\t\t\t</view> -->\r\n\r\n\t\t</view>\r\n\t</uni-popup>\r\n</template>\r\n\r\n<script setup>\r\n\t// import Popup1 from '../../components/Popup/Popup1.vue';\r\n\timport {\r\n\t\tcomputed,\r\n\t\tnextTick,\r\n\t\tonMounted,\r\n\t\tonUnmounted,\r\n\t\tonUpdated,\r\n\t\tref\r\n\t} from 'vue';\r\n\timport {\r\n\t\tonLoad\r\n\t} from '@dcloudio/uni-app'\r\n\timport {\r\n\t\tuseCartStore\r\n\t} from '/stores/cart';\r\n\timport {\r\n\t\tstoreToRefs\r\n\t} from 'pinia'\r\n\r\n\tconst props = defineProps({\r\n\t\tgood: {\r\n\t\t\ttype: Object, //当前选择的商品\r\n\t\t\tdefault: () => ({})\r\n\t\t}\r\n\t})\r\n\tconst store = useCartStore() //购物车store\r\n\t\tconst {\r\n\t\t\tcart\r\n\t\t} = storeToRefs(store)\r\n\t\tconst {\r\n\t\t\tupdateCart\r\n\t\t} = store\r\n\tconst popupRef = ref(null) //BUG:ref要在props后定义\r\n\tconst visible = ref(false) //\r\n\r\n\tconst ingredientList = ref([]) //小料列表数据\r\n\tconst ingredientMap = ref({}) //小料列表映射\r\n\tconst addMap = ref({}) //加料列表数据\r\n\tconst goodTotal = ref(1) //商品个数\r\n\t// onLoad(() => {\r\n\t// \t//获取数据\r\n\t// \timport('/api/add.json').then(res => {\r\n\t// \t\tingredientList.value = res.default\r\n\t// \t\tres.default.forEach((item) => {\r\n\t// \t\t\tingredientMap\r\n\t// \t\t\t\t.value[item.id] = item\r\n\t// \t\t})\r\n\t// \t})\r\n\t// })\r\n\tonMounted(()=>{\r\n\t\tconsole.log('mounted',visible.value,popupRef.value)\r\n\t})\r\n\tonUpdated(()=>{\r\n\t\tconsole.log('update',visible.value,popupRef.value)\r\n\t})\r\n\tconst addListTitleShow = computed(() => {\r\n\t\tconst show = Object.keys(addMap.value).length != 0 || Object.keys(addMap.value).some(id => addMap.value?.[\r\n\t\t\tid\r\n\t\t] !== 0)\r\n\t\tconsole.log(Object.keys(addMap.value).length, 'show')\r\n\t\treturn show\r\n\t})\r\n\t//加料展示标题\r\n\tconst addListTitle = computed(() => {\r\n\t\tconst title = []\r\n\t\tObject.keys(addMap.value).forEach((id) => {\r\n\t\t\tif (addMap.value[id]) title.push(ingredientMap.value[id].label + 'x ' + addMap.value[id])\r\n\t\t})\r\n\t\treturn title.join('、')\r\n\t})\r\n\t//总价格\r\n\tconst totalPrice = computed(() => {\r\n\t\tconst ingredientPrice = Object.keys(addMap.value).reduce((pre, id) => {\r\n\t\t\tpre = pre + ingredientMap.value[id].price * addMap.value[id]\r\n\t\t\treturn pre\r\n\t\t}, 0)\r\n\t\tconst goodPirce = goodTotal.value * (props.good?.price || 0)\r\n\t\treturn ingredientPrice + goodPirce\r\n\t})\r\n\t//跳转购买页面\r\n\tconst buyNow = () => {}\r\n\t//加入购物车\r\n\tconst addCart = () => {\r\n\t\tconst ingredient = []\r\n\t\tObject.keys(addMap.value).forEach((id) => {\r\n\t\t\tif (addMap.value[id]) ingredient.push({\r\n\t\t\t\t...ingredientMap.value[id],\r\n\t\t\t\ttotal: addMap.value[id]\r\n\t\t\t})\r\n\t\t})\r\n\t\tconst obj = {\r\n\t\t\t...props.good,\r\n\t\t\tingredient\r\n\t\t}\r\n\t\tupdateCart((value) => [...value, obj])\r\n\t\tpopupRef.value?.close()\r\n\t}\r\n\r\n\t//加减小料\r\n\tconst updateAddMap = (ingredient, total) => {\r\n\t\taddMap.value[ingredient.id] = total\r\n\t}\r\n\t//更新商品个数\r\n\tconst updateGoodTotal = (total) => {\r\n\t\tgoodTotal.value = total\r\n\t}\r\n\t//暴露modal方法\r\n\tconst open = () => {\r\n\t\tconsole.log('调用open', popupRef.value)\r\n\t\tif(popupRef.value){\r\n\t\t\tvisible.value = true\r\n\t\t\tpopupRef.value?.open()\r\n\t\t}\r\n\t};\r\n\tdefineExpose({\r\n\t\topen\r\n\t})\r\n\t//modal change\r\n\tconst $emit = defineEmits(['change'])\r\n\tconst modalChange = ({show}) => {\r\n\t\taddMap.value = {}\r\n\t\tgoodTotal.value = 1\r\n\t\tvisible.value = show\r\n\t\t$emit('change', show)\r\n\t}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n\t@import '../../style/common.scss';\r\n\r\n\t.container {\r\n\t\tposition: relative;\r\n\t\theight: 90vh;\r\n\t\tbox-sizing: border-box;\r\n\t\tborder-radius: 10px 10px 0 0;\r\n\t\tbackground: #fff;\r\n\t}\r\n\r\n\t.close {\r\n\t\tposition: absolute;\r\n\t\tright: 30rpx;\r\n\t\ttop: 30rpx;\r\n\t\tbackground: rgba(0, 0, 0, 0.1);\r\n\t\tcolor: #fff;\r\n\r\n\t}\r\n\r\n\t.good {\r\n\t\tposition: relative;\r\n\t\toverflow-y: auto;\r\n\t\tpadding-bottom: 160rpx;\r\n\r\n\t\t&-img {\r\n\t\t\t// display: block;\r\n\t\t\twidth: 600rpx;\r\n\t\t\t// height: 100%;\r\n\t\t}\r\n\r\n\t\t&-main {\r\n\t\t\twidth: 700rpx;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tborder-bottom: 1px solid $border-base;\r\n\t\t\tpadding: spacing-size(4) 0;\r\n\t\t}\r\n\r\n\t\t&-label {\r\n\t\t\tfont-weight: 500;\r\n\t\t}\r\n\r\n\t\t&-sell {\r\n\t\t\tcolor: $light-gray;\r\n\t\t}\r\n\r\n\t\t.add {\r\n\t\t\twidth: 700rpx;\r\n\r\n\t\t\t&-title {\r\n\t\t\t\tfont-weight: 500;\r\n\t\t\t\tpadding: spacing-size(3) 0;\r\n\t\t\t}\r\n\r\n\t\t\t&-item {\r\n\t\t\t\t// box-sizing: border-box;\r\n\t\t\t\tpadding: spacing-size(2) spacing-size(3);\r\n\r\n\t\t\t\t&:not(last-child) {\r\n\t\t\t\t\tmargin-bottom: spacing-size(4);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbackground: #eee;\r\n\t\t\t\t@include radius-size(base);\r\n\t\t\t\tline-height: 40rpx;\r\n\r\n\t\t\t\t&-label {\r\n\t\t\t\t\tcolor: $dark-gold;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t&-price {\r\n\t\t\t\t\tcolor: $dark-gold;\r\n\t\t\t\t\tmargin: 0 150rpx 0 auto;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t&-number {\r\n\t\t\t\t\tmargin: 0 spacing-size(2);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t&-btn {\r\n\t\t\t\t\twidth: 40rpx;\r\n\t\t\t\t\theight: 40rpx;\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\tborder-radius: 50%;\r\n\r\n\t\t\t\t\t&-add {\r\n\t\t\t\t\t\tcolor: $text-primary ;\r\n\t\t\t\t\t\tbackground: $dark-gold;\r\n\t\t\t\t\t\tposition: relative;\r\n\r\n\t\t\t\t\t\t&::after {\r\n\t\t\t\t\t\t\tcontent: '+';\r\n\t\t\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\t\t\ttop: 0rpx;\r\n\t\t\t\t\t\t\tleft: 50%;\r\n\t\t\t\t\t\t\ttransform: translateX(-50%);\r\n\t\t\t\t\t\t\t@include font-size(lg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t&-sub {\r\n\t\t\t\t\t\tborder: 1px solid $dark-gold;\r\n\t\t\t\t\t\tcolor: $dark-gold;\r\n\t\t\t\t\t\tposition: relative;\r\n\r\n\t\t\t\t\t\t&::after {\r\n\t\t\t\t\t\t\tcontent: '—';\r\n\t\t\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\t\t\ttop: 0rpx;\r\n\t\t\t\t\t\t\tleft: 50%;\r\n\t\t\t\t\t\t\ttransform: translateX(-50%);\r\n\t\t\t\t\t\t\t@include font-size(xs);\r\n\t\t\t\t\t\t\tfont-weight: 500;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.bottom-add {\r\n\t\tbackground: #eee;\r\n\t\tposition: fixed;\r\n\t\twidth: 100%;\r\n\t\tz-index: 10;\r\n\t\tbottom: 160rpx;\r\n\t\tbox-sizing: border-box;\r\n\t}\r\n\r\n\t.bottom {\r\n\t\tposition: fixed;\r\n\t\twidth: 100%;\r\n\t\tbox-sizing: border-box;\r\n\t\tz-index: 10;\r\n\t\tbottom: 0;\r\n\t\theight: 160rpx;\r\n\t\tbackground: #fff;\r\n\r\n\t\t&-total {\r\n\t\t\t&-title {\r\n\t\t\t\tcolor: $dark-gold;\r\n\t\t\t}\r\n\r\n\t\t\t&-price {}\r\n\t\t}\r\n\r\n\t\t&-btn {\r\n\t\t\t// box-sizing: border-box;\r\n\t\t\twidth: 352rpx;\r\n\t\t}\r\n\t}\r\n</style>","import Component from 'F:/code/BurgerOrder/pages/menu/goodModal.vue'\nwx.createComponent(Component)"],"names":["useCartStore","storeToRefs","ref","onMounted","uni","onUpdated","computed"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAgEC,UAAM,QAAQ;AAMd,UAAM,QAAQA,YAAAA,aAAc;AAGvBC,kBAAAA,YAAY,KAAK;AAItB,UAAM,WAAWC,cAAG,IAAC,IAAI;AACzB,UAAM,UAAUA,cAAG,IAAC,KAAK;AAEFA,kBAAAA,IAAI,CAAA,CAAE;AAC7B,UAAM,gBAAgBA,cAAG,IAAC,EAAE;AAC5B,UAAM,SAASA,cAAG,IAAC,EAAE;AACrB,UAAM,YAAYA,cAAG,IAAC,CAAC;AAWvBC,kBAAAA,UAAU,MAAI;AACbC,0BAAY,MAAA,OAAA,kCAAA,WAAU,QAAQ,OAAM,SAAS,KAAK;AAAA,IACpD,CAAE;AACDC,kBAAAA,UAAU,MAAI;AACbD,0BAAY,MAAA,OAAA,kCAAA,UAAS,QAAQ,OAAM,SAAS,KAAK;AAAA,IACnD,CAAE;AACwBE,kBAAAA,SAAS,MAAM;AACvC,YAAM,OAAO,OAAO,KAAK,OAAO,KAAK,EAAE,UAAU,KAAK,OAAO,KAAK,OAAO,KAAK,EAAE,KAAK,QAAM;;AAAA,6BAAO,UAAP,mBAC1F,SACK;AAAA,OAAC;AACPF,oBAAAA,MAAY,MAAA,OAAA,mCAAA,OAAO,KAAK,OAAO,KAAK,EAAE,QAAQ,MAAM;AACpD,aAAO;AAAA,IACT,CAAE;AAEoBE,kBAAAA,SAAS,MAAM;AACnC,YAAM,QAAQ,CAAE;AAChB,aAAO,KAAK,OAAO,KAAK,EAAE,QAAQ,CAAC,OAAO;AACzC,YAAI,OAAO,MAAM,EAAE;AAAG,gBAAM,KAAK,cAAc,MAAM,EAAE,EAAE,QAAQ,OAAO,OAAO,MAAM,EAAE,CAAC;AAAA,MAC3F,CAAG;AACD,aAAO,MAAM,KAAK,GAAG;AAAA,IACvB,CAAE;AAEkBA,kBAAAA,SAAS,MAAM;;AACjC,YAAM,kBAAkB,OAAO,KAAK,OAAO,KAAK,EAAE,OAAO,CAAC,KAAK,OAAO;AACrE,cAAM,MAAM,cAAc,MAAM,EAAE,EAAE,QAAQ,OAAO,MAAM,EAAE;AAC3D,eAAO;AAAA,MACP,GAAE,CAAC;AACJ,YAAM,YAAY,UAAU,WAAS,WAAM,SAAN,mBAAY,UAAS;AAC1D,aAAO,kBAAkB;AAAA,IAC3B,CAAE;AA6BD,UAAM,OAAO,MAAM;;AAClBF,oBAAY,MAAA,MAAA,OAAA,mCAAA,UAAU,SAAS,KAAK;AACpC,UAAG,SAAS,OAAM;AACjB,gBAAQ,QAAQ;AAChB,uBAAS,UAAT,mBAAgB;AAAA,MAChB;AAAA,IACH;AACC,aAAa;AAAA,MACZ;AAAA,IACF,CAAE;AAED,UAAM,QAAQ;AACd,UAAM,cAAc,CAAC,EAAC,KAAI,MAAM;AAC/B,aAAO,QAAQ,CAAE;AACjB,gBAAU,QAAQ;AAClB,cAAQ,QAAQ;AAChB,YAAM,UAAU,IAAI;AAAA,IACpB;;;;;;;;;;;;;;;ACxKF,GAAG,gBAAgB,SAAS;"}