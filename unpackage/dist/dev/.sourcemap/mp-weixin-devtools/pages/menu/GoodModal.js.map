{"version":3,"names":["common_vendor","storeToRefs","store","_store","updateCart","props","__props","ingredientList","ref","ingredientMap","addMap","goodTotal","onLoad","Promise","resolve","require","then","res","value","default","forEach","item","id","goodModal","addListTitle","computed","oldVal","title","Object","keys","push","label","join","totalPrice","ingredientPrice","reduce","pre","price","goodPirce","_a","good","index","__f__","buyNow","addCart","ingredient","_objectSpread2","total","obj","concat","_toConsumableArray2","close","updateAddMap","updateGoodTotal","open","direction","__expose","$emit","__emit","modalChange","_ref2","show","wx","createComponent","Component"],"sources":["GoodModal.vue","RjovY29kZS9CdXJnZXJPcmRlci9wYWdlcy9tZW51L0dvb2RNb2RhbC52dWU"],"sourcesContent":["<template>\r\n\t<uni-popup ref=\"goodModal\" type=\"bottom\" border-radius=\"10px 10px 0 0\" background-color=\"#fff\"\r\n\t\t@change=\"modalChange\">\r\n\t\t<view>\r\n\t\t\t<scroll-view scroll-y>\r\n\t\t\t\t<view class=\"flex column good items-center\">\r\n\t\t\t\t\t<view class=\"good-img p-2\">\r\n\t\t\t\t\t\t<image :src=\"props.good?.image\" mode=\"aspectFit\" style=\"width: 100%;\r\n\t\t\t\t\t\t\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"good-main flex justify-between items-center\">\r\n\t\t\t\t\t\t<text class=\"good-label  fs-md\">{{props.good?.label}}</text>\r\n\t\t\t\t\t\t<text class=\"good-sell fs-sm\">月售{{props.good?.sell}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"add flex column\">\r\n\t\t\t\t\t\t<text class=\"add-title fs-sm\">来点小料</text>\r\n\t\t\t\t\t\t<view v-for=\"(ingredient,key) in ingredientList\" :key=\"key\"\r\n\t\t\t\t\t\t\tclass=\"add-item flex justify-between items-center\">\r\n\t\t\t\t\t\t\t<text class=\"add-item-label\">{{ingredient.label}}</text>\r\n\t\t\t\t\t\t\t<text class=\"add-item-price\">￥{{ingredient.price}}</text>\r\n\t\t\t\t\t\t\t<AddSubtractButton @reduce=\"(total)=>updateAddMap(ingredient,total)\"\r\n\t\t\t\t\t\t\t\t@add=\"(total)=>updateAddMap(ingredient,total)\"></AddSubtractButton>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t\t<view class=\"flex justify-between bottom-add p-1\">\r\n\t\t\t\t<text class=\"fs-sm\">已选：{{addListTitle}}</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"bottom flex justify-between column\">\r\n\r\n\t\t\t\t<view class=\"flex justify-between bottom-total  m-2\">\r\n\t\t\t\t\t<text class=\"bottom-total-title fs-md\">￥<text\r\n\t\t\t\t\t\t\tclass=\"bottom-total-price fs-xl\">{{totalPrice}}</text>/个</text>\r\n\t\t\t\t\t<AddSubtractButton @reduce=\"updateGoodTotal\" @add=\"updateGoodTotal\" :init=\"1\" :minNumber=\"1\">\r\n\t\t\t\t\t</AddSubtractButton>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"flex justify-between   m-2\">\r\n\t\t\t\t\t<s-button @tap=\"buyNow\" class=\"bottom-btn\">立即购买</s-button>\r\n\t\t\t\t\t<s-button @tap=\"addCart\" class=\"bottom-btn\" primary>加入购物车</s-button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t</view>\r\n\t</uni-popup>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tcomputed,\r\n\t\tonMounted,\r\n\t\tref\r\n\t} from 'vue';\r\n\timport {\r\n\t\tonLoad\r\n\t} from '@dcloudio/uni-app'\r\n\timport { useCartStore } from '/stores/cart';\r\n\t\timport {storeToRefs} from 'pinia'\r\n\tconst {cart} = storeToRefs(store)\r\n\tconst {updateCart} = store\r\n\tconst props = defineProps({\r\n\t\tgood: {\r\n\t\t\ttype: Object, //当前选择的商品\r\n\t\t\tdefault: () => ({})\r\n\t\t}\r\n\t})\r\n\tconst ingredientList = ref([]) //小料列表数据\r\n\tconst ingredientMap = ref({}) //小料列表映射\r\n\tconst addMap = ref({}) //加料列表数据\r\n\tconst goodTotal = ref(1) //商品个数\r\n\tonLoad(() => {\r\n\t\t//获取数据\r\n\t\timport('/api/add.json').then(res => {\r\n\t\t\tingredientList.value = res.default\r\n\t\t\tres.default.forEach((item) => {\r\n\t\t\t\tingredientMap\r\n\t\t\t\t\t.value[item.id] = item\r\n\t\t\t})\r\n\t\t})\r\n\t})\r\n\tconst goodModal = ref(null)\r\n\t//加料展示标题\r\n\tconst addListTitle = computed((oldVal) => {\r\n\t\tconst title = []\r\n\t\tObject.keys(addMap.value).forEach((id) => {\r\n\t\t\tif (addMap.value[id]) title.push(ingredientMap.value[id].label + 'x ' + addMap.value[id])\r\n\t\t})\r\n\t\treturn title.join('、')\r\n\t})\r\n\t//总价格\r\n\tconst totalPrice = computed((oldVal) => {\r\n\t\tconst ingredientPrice = Object.keys(addMap.value).reduce((pre, id) => {\r\n\t\t\tpre = pre + ingredientMap.value[id].price * addMap.value[id]\r\n\t\t\treturn pre\r\n\t\t}, 0)\r\n\t\tconst goodPirce = goodTotal.value * (props.good?.price || 0)\r\n\t\tconsole.log(goodTotal, goodPirce, 'goodPirce')\r\n\t\treturn ingredientPrice + goodPirce\r\n\t})\r\n\tconst buyNow = () => {\r\n\t\t//跳转购买页面\r\n\t}\r\n\tconst addCart = () =>{\r\n\t\tconst ingredient = []\r\n\t\tObject.keys(addMap.value).forEach((id) => {\r\n\t\t\tif (addMap.value[id]) ingredient.push({...ingredientMap.value[id],total:addMap.value[id]})\r\n\t\t})\r\n\t\tconst obj = {...props.good,ingredient}\r\n\t\tupdateCart((value)=>{\r\n\t\t\tvalue=[...value,obj]\r\n\t\t})\r\n\t\tgoodModal.value?.close()\r\n\t}\r\n\t\r\n\t//加减小料\r\n\tconst updateAddMap = (ingredient, total) => {\r\n\t\taddMap.value[ingredient.id] = total\r\n\t}\r\n\t//更新商品个数\r\n\tconst updateGoodTotal = (total) => {\r\n\t\tgoodTotal.value = total\r\n\t}\r\n\t//暴露modal方法\r\n\tconst open = (direction) => {\r\n\t\tgoodModal.value?.open(direction); // 通过ref调用组件内的方法\r\n\t};\r\n\tdefineExpose({\r\n\t\topen\r\n\t})\r\n\t//modal change\r\n\tconst $emit = defineEmits(['change'])\r\n\tconst modalChange = ({\r\n\t\tshow\r\n\t}) => {\r\n\t\taddMap.value = {}\r\n\t\tgoodTotal.value = 1\r\n\t\t$emit('change', show)\r\n\t}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n\t@import '../../style/common.scss';\r\n\r\n\t.good {\r\n\t\tposition: relative;\r\n\t\theight: 90vh;\r\n\t\toverflow-y: auto;\r\n\t\tbox-sizing: border-box;\r\n\t\tpadding-bottom: 160rpx;\r\n\r\n\t\t&-img {\r\n\t\t\t// display: block;\r\n\t\t\twidth: 600rpx;\r\n\t\t\t// height: 100%;\r\n\t\t}\r\n\r\n\t\t&-main {\r\n\t\t\twidth: 700rpx;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tborder-bottom: 1px solid $border-base;\r\n\t\t\tpadding: spacing-size(4) 0;\r\n\t\t}\r\n\r\n\t\t&-label {\r\n\t\t\tfont-weight: 500;\r\n\t\t}\r\n\r\n\t\t&-sell {\r\n\t\t\tcolor: $light-gray;\r\n\t\t}\r\n\r\n\t\t.add {\r\n\t\t\twidth: 700rpx;\r\n\r\n\t\t\t&-title {\r\n\t\t\t\tfont-weight: 500;\r\n\t\t\t\tpadding: spacing-size(3) 0;\r\n\t\t\t}\r\n\r\n\t\t\t&-item {\r\n\t\t\t\t// box-sizing: border-box;\r\n\t\t\t\tpadding: spacing-size(2) spacing-size(3);\r\n\r\n\t\t\t\t&:not(last-child) {\r\n\t\t\t\t\tmargin-bottom: spacing-size(4);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbackground: #eee;\r\n\t\t\t\t@include radius-size(base);\r\n\t\t\t\tline-height: 40rpx;\r\n\r\n\t\t\t\t&-label {\r\n\t\t\t\t\tcolor: $dark-gold;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t&-price {\r\n\t\t\t\t\tcolor: $dark-gold;\r\n\t\t\t\t\tmargin: 0 150rpx 0 auto;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t&-number {\r\n\t\t\t\t\tmargin: 0 spacing-size(2);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t&-btn {\r\n\t\t\t\t\twidth: 40rpx;\r\n\t\t\t\t\theight: 40rpx;\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\tborder-radius: 50%;\r\n\r\n\t\t\t\t\t&-add {\r\n\t\t\t\t\t\tcolor: $text-primary ;\r\n\t\t\t\t\t\tbackground: $dark-gold;\r\n\t\t\t\t\t\tposition: relative;\r\n\r\n\t\t\t\t\t\t&::after {\r\n\t\t\t\t\t\t\tcontent: '+';\r\n\t\t\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\t\t\ttop: 0rpx;\r\n\t\t\t\t\t\t\tleft: 50%;\r\n\t\t\t\t\t\t\ttransform: translateX(-50%);\r\n\t\t\t\t\t\t\t@include font-size(lg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t&-sub {\r\n\t\t\t\t\t\tborder: 1px solid $dark-gold;\r\n\t\t\t\t\t\tcolor: $dark-gold;\r\n\t\t\t\t\t\tposition: relative;\r\n\r\n\t\t\t\t\t\t&::after {\r\n\t\t\t\t\t\t\tcontent: '—';\r\n\t\t\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\t\t\ttop: 0rpx;\r\n\t\t\t\t\t\t\tleft: 50%;\r\n\t\t\t\t\t\t\ttransform: translateX(-50%);\r\n\t\t\t\t\t\t\t@include font-size(xs);\r\n\t\t\t\t\t\t\tfont-weight: 500;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.bottom-add {\r\n\t\tbackground: #eee;\r\n\t\tposition: fixed;\r\n\t\twidth: 100%;\r\n\t\tz-index: 10;\r\n\t\tbottom: 160rpx;\r\n\t\tbox-sizing: border-box;\r\n\t}\r\n\r\n\t.bottom {\r\n\t\tposition: fixed;\r\n\t\twidth: 100%;\r\n\t\tbox-sizing: border-box;\r\n\t\tz-index: 10;\r\n\t\tbottom: 0;\r\n\t\theight: 160rpx;\r\n\t\tbackground: #fff;\r\n\r\n\t\t&-total {\r\n\t\t\t&-title {\r\n\t\t\t\tcolor: $dark-gold;\r\n\t\t\t}\r\n\r\n\t\t\t&-price {}\r\n\t\t}\r\n\r\n\t\t&-btn {\r\n\t\t\t// box-sizing: border-box;\r\n\t\t\twidth: 352rpx;\r\n\t\t}\r\n\t}\r\n</style>","import Component from 'F:/code/BurgerOrder/pages/menu/GoodModal.vue'\nwx.createComponent(Component)"],"mappings":"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","ignoreList":[]}